<script type="text/javascript">
    RED.nodes.registerType('algorithm', {
        category: 'autoAI pipeline',
        color: '#2E8B57',
        defaults: {
            name: {value:""},
            algorithm: {value:"", required:true},
            max_depth: {
                value: "20", 
                required: true,
                validate: function(x) {
                    return /^[1-9]\d*$/.test(x);
                } 
            },
            min_samples_split: { 
                value: "2", 
                required: true,
                validate: function(x) {
                    x = Number(x);
                    return x >= 2;
                }
            },
            min_samples_leaf: { 
                value: "2", 
                required: true,
                validate: function(x) {
                    x = Number(x);
                    return x >= 1;
                }
            },
            n_estimators: {
                 value: "100",
                 required: true,
                 validate: function(x) {
                    return /^(?:[1-9]\d{2,}|[1-9]\d|10)$/.test(x);
                }
            },
            criterion : {value:"gini", required:true },
            splitter: { value: "best", required: true },
            penalty : {value:"l2", required:true},
            solver : {value:"lbfgs", required:true},                       
        },
        inputs:1,
        outputs:1,
        icon: "font-awesome/fa-link",
        label: function() {
            return this.name || this.algorithm || "algorithm";
        },
        oneditprepare: function() {
    
            function toggleVisibility() {
                var algorithmValue = $("#node-input-algorithm").val();
                
                $(".toggle-common,.toggle-randomforest,.toggle-decisiontree,.toggle-logisticregression").hide();
            
                if (algorithmValue === "decisiontree") {
                    $(".toggle-common, .toggle-decisiontree").show();
                    $("#node-input-n_estimators").val("100")

                }else if(algorithmValue === "randomforest"){
                    $(".toggle-common, .toggle-randomforest").show();
                    
                }else if(algorithmValue === "logisticregression"){
                    $(".toggle-logisticregression").show();
                    $("#node-input-n_estimators").val("100")
                    $("#node-input-max_depth").val("20")
                    $("#node-input-min_samples_split").val("2")
                    $("#node-input-min_samples_leaf").val("2")
                    
                }
            }

            toggleVisibility()

            $("#node-input-algorithm").on("change", toggleVisibility);
        },

    });
</script>

<script type="text/x-red" data-template-name="algorithm">
    <div class="form-row">
        <label for="node-input-name">Name</label>
        <input type="text" id="node-input-name" placeholder="Name" />
    </div>
    <div class="form-row">
        <label for="node-input-algorithm">Algorithm</label>
        <select id="node-input-algorithm">
            <option value="decisiontree">Decision Tree</option>
            <option value="randomforest">Random Forest</option>
            <option value="logisticregression">Logistic Regression</option>
        </select>
    </div>
    

    <!-- Random Forest Specific Fields -->
    <div class="form-row toggle-randomforest">
        <label for="node-input-n_estimators"><i class="fa"></i>n_estimators</label>
        <input type="number" min="10" id="node-input-n_estimators" />
    </div>

    <!-- RF&DT Common Fields -->
    <div class="form-row toggle-common">
        <label for="node-input-max_depth" id="max_depth"
          ><i class="fa"></i>Max Depth
        </label>
        <input type="number" min="1" id="node-input-max_depth" />
        <br>
        <label for="node-input-min_samples_split" id="min_samples_split"
        ><i class="fa"></i>min_samples_split
        </label>
        <input type="number" min="2" step="0.1" id="node-input-min_samples_split" style="width: 306px; margin-left: 23px;" />
        <br>
        <label for="node-input-min_samples_leaf" id="min_samples_leaf"
          ><i class="fa"></i>min_samples_leaf
        </label>
        <input type="number" min="1" step="0.1" id="node-input-min_samples_leaf" style="width: 309px; margin-left: 20px;" />
        <br><br>
        <label for="node-input-criterion">Criterion</label>
        <select id="node-input-criterion">
            <option value="gini">gini</option>
            <option value="entropy">entropy</option>
            <option value="log_loss">log_loss</option>
        </select>
    </div>
    
    <!-- Decision Tree Specific Fields -->
    <div class="form-row toggle-decisiontree">
        <label for="node-input-splitter">Splitter</label>
        <select id="node-input-splitter">
            <option value="random">random</option>
            <option value="best">best</option>
        </select>
    </div>
    <div class="form-tips toggle-decisiontree">
        <p>
          For more details about parameter using in the classifier, see <a href="https://scikit-learn.org/stable/modules/generated/sklearn.tree.DecisionTreeClassifier.html" target="_blank" rel="noopener noreferrer">this documentation</a>.
        </p>
    </div> 
    
    <!-- Random Forest Specific Fields -->
    <div class="form-tips toggle-randomforest">
        <p>
            For more details about parameter using in the classifier, see <a href="https://scikit-learn.org/stable/modules/generated/sklearn.ensemble.RandomForestClassifier.html#sklearn.ensemble.RandomForestClassifier" target="_blank" rel="noopener noreferrer">this documentation</a>.
        </p>
    </div>

    <!-- Logistic Regression Specific Fields -->
    <div class="form-row toggle-logisticregression">  
        <label for="node-input-penalty">Penalty</label>
        <select id="node-input-penalty">
            <option value="l1">l1</option>
            <option value="l2">l2</option>
            <option value="elasticnet">elasticnet</option>
            <option value="None">None</option>
        </select>
    </div>
    <div class="form-row toggle-logisticregression">  
        <label for="node-input-solver">Solver</label>
        <select id="node-input-solver">
            <option value="lbfgs">lbfgs</option>
            <option value="liblinear">liblinear</option>
            <option value="newton-cg">newton-cg</option>
            <option value="newton-cholesky">newton-cholesky</option>
            <option value="sag">sag</option>
            <option value="saga">saga</option>
        </select>
    </div>
    <div class="form-tips toggle-logisticregression">
        <p>
            For more details about parameter using in the classifier see <a href="https://scikit-learn.org/stable/modules/generated/sklearn.linear_model.LogisticRegression.html#sklearn.linear_model.LogisticRegression" target="_blank" rel="noopener noreferrer">this documentation</a>.
        </p>
    </div>
</script>

<script type="text/x-red" data-help-name="algorithm">
    <p>A node for different algorithms.</p>
</script>




